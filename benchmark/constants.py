import montepy

import numpy as np


"""
These data were aggregated from a subset of MCNP models included in the following projects:

Nuclear Energy Agency (2020). Internationl Handbook of Evaluated criticality Safety Benchmark Experiments. 
    Paris, OECD Nuclear Energy Agency.

Nuclear Energy Agency (2023). International Handbook of Evaluated Reactor Physics Benchmark Experiments, 
    Nuclear Energy Agency, Organisation for Economic Co-operation and Development.
"""

SURF_ABOVE_CURVE = lambda: np.random.binomial(1, 0.949)

SURF_TOP_CURVE = lambda x: 1.45 * x**0.93

SURF_BOT_CURVE = lambda x: 12.62 * x**0.40

MATERIAL_CURVE = lambda x: 1.48 * x**0.43

OBJ_NUMBER = lambda: np.random.randint(1, 99_999_999)

ATOM_MASS_DENSITY = lambda: np.random.binomial(1, 0.5)


def MASS_DENSITY():
    sample = np.random.normal(5.0, 1.0)
    return sample if sample > 0.0 else 0.001


def ATOM_DENSITY():
    sample = np.random.normal(0.01, 1e-3)
    return sample if sample > 0.0 else 0.001


GEOM_OP = lambda: np.random.choice(
    [
        montepy.Operator.INTERSECTION,
        montepy.Operator.UNION,
        montepy.Operator.COMPLEMENT,
    ],
    p=[0.9879, 0.004132, 6.1e-4],
)


def N_CELLS_NOISE(n):
    new_n = np.round(np.random.normal(n, 0.05 * n))
    new_n = 1 if new_n < 0 else new_n
    return int(new_n)


_st = montepy.SurfaceType
_p = np.array(
    [
        0.387353,
        0.169831,
        0.127609,
        0.093485,
        0.062539,
        0.053166,
        0.047198,
        0.022552,
        0.006978,
        6.458e-3,
        4.969e-3,
        4.191e-3,
        3.942e-3,
        3.446e-3,
        1.802e-3,
        1.415e-3,
        1.012e-3,
        5.62e-4,
        5.28e-4,
        4.99e-4,
        1.70e-4,
        1.57e-4,
        1.16e-4,
        2.1e-5,
    ]
)
_p = _p / np.sum(_p)
SURF_TYPE = lambda: np.random.choice(
    [
        _st.PZ,
        _st.CZ,
        _st.SO,
        _st.PX,
        _st.PY,
        _st.C_Z,
        _st.RCC,
        _st.P,
        _st.RPP,
        _st.CX,
        _st.C_Y,
        _st.SPH,
        _st.C_X,
        _st.SX,
        _st.Z,
        _st.CY,
        _st.KZ,
        _st.BOX,
        _st.RHP,
        _st.SY,
        _st.SQ,
        _st.SZ,
        _st.TRC,
        _st.S,
    ],
    p=_p,
)

NUM_CONSTANTS = {
    _st.PZ: 1,
    _st.CZ: 1,
    _st.SO: 1,
    _st.PX: 1,
    _st.PY: 1,
    _st.C_Z: 3,
    _st.C_X: 3,
    _st.RCC: 7,
    _st.P: 4,
    _st.RPP: 6,
    _st.CX: 1,
    _st.C_Y: 3,
    _st.SX: 2,
    _st.Z: 9,
    _st.CY: 1,
    _st.KZ: 3,
    _st.BOX: 12,
    _st.RHP: 15,
    _st.SY: 2,
    _st.SQ: 10,
    _st.SZ: 2,
    _st.TRC: 8,
    _st.S: 4,
    _st.SPH: 4,
}
SURFACE_CONSTANT = lambda: np.round(
    np.random.uniform(0.0, 15.0), np.random.randint(1, 8)
)

USES_UNIVERSES = lambda: np.random.binomial(1, 0.3234)

NUM_SURFS_IN_CELL = lambda: np.random.exponential(4.1599)

CELL_GEOM_COMP = lambda: np.random.binomial(1, 7.728e-3)

CELL_GEOM_INTERSECT = lambda: np.random.binomial(1, 0.987911)

CELL_GEOM_SIDE = lambda: np.random.binomial(1, 0.46007)

NUM_NUCLIDES = lambda: np.random.exponential(9.8915)

ISOTOPE = lambda: np.random.choice(
    [
        "O-16",
        "H-1",
        "C-0",
        "Fe-0",
        "U-238",
        "Mn-55",
        "U-235",
        "N-14",
        "U-234",
        "Si-0",
        "Cr-0",
        "Ni-0",
        "Al-27",
        "Pu-239",
        "Pu-240",
        "U-236",
        "Fe-56",
        "Fe-57",
        "Fe-54",
        "Fe-58",
        "Pu-241",
        "Ti-0",
        "Pu-242",
        "Cr-52",
        "Cr-50",
        "Cr-54",
        "Cr-53",
        "Ni-58",
        "Ni-60",
        "C-12",
        "Ni-62",
        "Ni-61",
        "Ni-64",
        "Cu-0",
        "S-32",
        "P-31",
        "Si-28",
        "Mg-0",
        "Pu-238",
        "B-10",
        "Si-29",
        "Si-30",
        "Cu-63",
        "Cu-65",
        "Na-23",
        "B-11",
        "Mo-0",
        "F-19",
        "Ca-0",
        "Am-241",
        "K-0",
        "Cd-0",
        "Co-59",
        "U-233",
        "Ti-48",
        "Gd-158",
        "Gd-156",
        "Gd-155",
        "Gd-154",
        "Gd-152",
        "Gd-160",
        "Gd-157",
        "Mo-95",
        "Mo-94",
        "Mo-100",
        "Mo-98",
        "Mo-92",
        "Mo-97",
        "Mo-96",
        "H-2",
        "O-17",
        "S-34",
        "Ti-50",
        "Ti-49",
        "Ti-47",
        "Ti-46",
        "S-33",
        "S-36",
        "Zr-0",
        "Ta-181",
        "N-15",
        "Li-6",
        "S-0",
        "Ga-0",
        "Mg-24",
        "Be-9",
        "Zn-0",
        "Ag-107",
        "Ag-109",
        "Ar-0",
        "V-0",
        "Nb-93",
        "Cd-113",
        "Cd-110",
        "Cd-106",
        "Cd-108",
        "Cd-112",
        "Cd-111",
        "Cd-116",
        "Cd-114",
        "W-183",
        "W-186",
        "W-182",
        "W-184",
        "Li-7",
        "Mg-25",
        "Mg-26",
        "Th-232",
        "Hf-0",
        "Ga-71",
        "Ga-69",
        "Gd-0",
        "U-232",
        "Ba-138",
        "V-50",
        "V-51",
        "Sn-0",
        "W-0",
        "Zn-64",
        "Zn-66",
        "Zn-70",
        "Zn-68",
        "Zn-67",
        "Cl-0",
        "Bi-209",
        "C-13",
        "Ca-40",
        "Ca-46",
        "Ca-43",
        "Ca-44",
        "Ca-42",
        "Cl-37",
        "Cl-35",
        "Zr-91",
        "Zr-90",
        "Zr-94",
        "Zr-92",
        "Zr-96",
        "Pb-208",
        "Pb-207",
        "Pb-206",
        "Sb-0",
        "Rb-87",
        "Rb-85",
        "Np-237",
        "Pt-0",
        "Cf-252",
        "Ca-48",
        "K-39",
        "K-40",
        "K-41",
        "O-18",
        "Pb-0",
        "Sn-115",
        "Sn-114",
        "Sn-112",
        "Sn-116",
        "Sn-122",
        "Sn-120",
        "Sn-119",
        "Sn-117",
        "Sn-124",
        "Sn-118",
        "Hf-178",
        "Hf-180",
        "Hf-179",
        "Hf-177",
        "Hf-176",
        "Hf-174",
        "Pb-204",
        "Rh-103",
        "As-75",
        "W-180",
        "Ba-130",
        "Ba-132",
        "Ba-134",
        "Ba-136",
        "Ba-135",
        "Ba-137",
        "Sb-123",
        "Sb-121",
        "Sm-149",
        "Au-197",
        "Xe-135",
        "Er-167",
        "Er-166",
        "Er-168",
        "Er-164",
        "Er-170",
        "Er-162",
        "Re-185",
        "Re-187",
        "Sr-88",
        "Sr-86",
        "Sr-84",
        "Sr-87",
        "In-115",
        "In-113",
        "Th-230",
        "In-0",
        "Ar-36",
        "Ar-38",
        "Ar-40",
        "Te-130",
        "Se-82",
        "Te-120",
        "Te-122",
        "Te-128",
        "Se-76",
        "Se-77",
        "Se-78",
        "Se-80",
        "Te-123",
        "Te-126",
        "Te-125",
        "Te-124",
        "Se-74",
        "Am-243",
        "He-4",
        "Lu-176",
        "Y-89",
        "Lu-175",
        "He-3",
        "Ne-20",
        "Ne-21",
        "Xe-136",
        "Xe-134",
        "Ne-22",
        "Kr-78",
        "Kr-80",
        "Kr-82",
        "Kr-83",
        "Kr-84",
        "Kr-86",
        "Xe-124",
        "Xe-126",
        "Xe-128",
        "Xe-129",
        "Xe-130",
        "Xe-131",
        "Xe-132",
        "Dy-162",
        "Dy-160",
        "Dy-158",
        "Dy-156",
        "Dy-161",
        "Br-79",
        "Dy-163",
        "Sm-148",
        "Sm-147",
        "Sm-144",
        "Br-81",
        "Dy-164",
        "Sm-154",
        "Sm-150",
        "Sm-152",
    ],
    p=[
        0.0785066551136448,
        0.0784247631402373,
        0.040222711740228644,
        0.03825573143375983,
        0.03589304330332537,
        0.035456321857593065,
        0.034249192966618,
        0.02907332191532224,
        0.028160360904563694,
        0.02793003968495647,
        0.025993428377096908,
        0.02586486147064833,
        0.021796199629602244,
        0.018481299248749517,
        0.017611370428905586,
        0.01754619484514181,
        0.015819267964015633,
        0.015219193360145959,
        0.015207543643816553,
        0.015147226453319822,
        0.013668718099156481,
        0.011995607390649234,
        0.010815111467593421,
        0.010744103857402033,
        0.010192683951143417,
        0.010192683951143417,
        0.010192683951143417,
        0.010118905467750629,
        0.010117071476931588,
        0.010023189858910759,
        0.009828100604015618,
        0.009828100604015618,
        0.00973079120879351,
        0.009403995440059446,
        0.009356447717246369,
        0.009226414794257549,
        0.008182744756851268,
        0.008037058143704175,
        0.0077303294066064145,
        0.007644661972248608,
        0.007582670152981597,
        0.007582670152981597,
        0.007431958195396701,
        0.006834969896972508,
        0.006335711161923533,
        0.005868934740157885,
        0.005499996516111034,
        0.004973136278591503,
        0.004956491859992906,
        0.004549087082532021,
        0.0040047765746929415,
        0.0034473399909835016,
        0.0028322530423142305,
        0.002830938439048612,
        0.002536531297067306,
        0.002488230046766501,
        0.002488230046766501,
        0.002488230046766501,
        0.002488230046766501,
        0.002488230046766501,
        0.002488230046766501,
        0.002488230046766501,
        0.0020921234930336395,
        0.0020921234930336395,
        0.0020921234930336395,
        0.0020921234930336395,
        0.0020921234930336395,
        0.0020921234930336395,
        0.0020921234930336395,
        0.002022915973133505,
        0.001995677149382279,
        0.0019685760332723143,
        0.001936456693197636,
        0.001936456693197636,
        0.001936456693197636,
        0.001936456693197636,
        0.001928854078830057,
        0.0018891321243877997,
        0.001851863658291978,
        0.0017613244300552112,
        0.0017230589365484193,
        0.001667214150164403,
        0.001575620482266817,
        0.0015477367498248032,
        0.0015205367022102627,
        0.0014670949648119438,
        0.0014668600267292698,
        0.0013388959149973213,
        0.0013138313738037478,
        0.0012443480886678642,
        0.0012383410474856185,
        0.0011655469249314432,
        0.0011202248570926152,
        0.0011202248570926152,
        0.0011202248570926152,
        0.0011202248570926152,
        0.0011202248570926152,
        0.0011202248570926152,
        0.0011202248570926152,
        0.0011202248570926152,
        0.0009971093704797145,
        0.0009971093704797145,
        0.0009971093704797145,
        0.0009971093704797145,
        0.0009920511716185333,
        0.0009204620983405921,
        0.0009204620983405921,
        0.0009146715567311101,
        0.0008226429233030044,
        0.0007192245890630682,
        0.0007192245890630682,
        0.0007077501467693309,
        0.0006680664248902464,
        0.0006679053385351384,
        0.0006054856673407337,
        0.0006054856673407337,
        0.0005896134928392994,
        0.0005866173323478827,
        0.0005653328827829324,
        0.0005653328827829324,
        0.0005653328827829324,
        0.0005653328827829324,
        0.0005653328827829324,
        0.0005047255017466503,
        0.00045890449242868653,
        0.00039001273587316044,
        0.00038793409468766785,
        0.00038793409468766785,
        0.00038793409468766785,
        0.00038793409468766785,
        0.00038793409468766785,
        0.00037418268879015043,
        0.00037418268879015043,
        0.0003357620455449445,
        0.0003357620455449445,
        0.0003357620455449445,
        0.0003357620455449445,
        0.0003357620455449445,
        0.00029205886514621084,
        0.00029205886514621084,
        0.00029205886514621084,
        0.0002840648001938325,
        0.00026152993544297903,
        0.00026152993544297903,
        0.00021960259151910003,
        0.0002074389171163365,
        0.0002074389171163365,
        0.00019308619409142333,
        0.00019145461291693032,
        0.00019145461291693032,
        0.00019145461291693032,
        0.00018487746332972649,
        0.00016517908696432783,
        0.0001552070744339297,
        0.0001552070744339297,
        0.0001552070744339297,
        0.0001552070744339297,
        0.0001552070744339297,
        0.0001552070744339297,
        0.0001552070744339297,
        0.0001552070744339297,
        0.0001552070744339297,
        0.0001552070744339297,
        0.00014286795537450105,
        0.00014286795537450105,
        0.00014286795537450105,
        0.00014286795537450105,
        0.00014286795537450105,
        0.00014286795537450105,
        0.00013396193636204496,
        0.00013340804183676195,
        0.00012945249808131968,
        0.00012776802705992323,
        0.00010358048181088564,
        0.00010358048181088564,
        0.00010358048181088564,
        0.00010358048181088564,
        0.00010358048181088564,
        0.00010358048181088564,
        9.051887961626331e-05,
        9.051887961626331e-05,
        6.394582571806577e-05,
        6.188679061309174e-05,
        5.9592510668655645e-05,
        4.3823371497395275e-05,
        4.3823371497395275e-05,
        4.3823371497395275e-05,
        4.3823371497395275e-05,
        4.3823371497395275e-05,
        4.3823371497395275e-05,
        4.298425348146955e-05,
        4.298425348146955e-05,
        3.6400342115281034e-05,
        3.6400342115281034e-05,
        3.6400342115281034e-05,
        3.6400342115281034e-05,
        3.431588559659987e-05,
        3.431588559659987e-05,
        3.0278860924022214e-05,
        2.5064541193573455e-05,
        1.4529545927120648e-05,
        1.4529545927120648e-05,
        1.4529545927120648e-05,
        1.2310802018576853e-05,
        1.2310802018576853e-05,
        1.2310802018576853e-05,
        1.2310802018576853e-05,
        1.2310802018576853e-05,
        1.2310802018576853e-05,
        1.2310802018576853e-05,
        1.2310802018576853e-05,
        1.2310802018576853e-05,
        1.2310802018576853e-05,
        1.2310802018576853e-05,
        1.2310802018576853e-05,
        1.2310802018576853e-05,
        1.2310802018576853e-05,
        1.2163674402763588e-05,
        7.68576318296775e-06,
        7.293914103949946e-06,
        7.293914103949946e-06,
        7.293914103949946e-06,
        5.950574527970677e-06,
        5.950574527970677e-06,
        5.950574527970677e-06,
        5.950574527970677e-06,
        5.950574527970677e-06,
        5.950574527970677e-06,
        5.950574527970677e-06,
        5.950574527970677e-06,
        5.950574527970677e-06,
        5.950574527970677e-06,
        5.950574527970677e-06,
        5.950574527970677e-06,
        5.950574527970677e-06,
        5.950574527970677e-06,
        5.950574527970677e-06,
        5.950574527970677e-06,
        5.950574527970677e-06,
        5.950574527970677e-06,
        5.950574527970677e-06,
        4.353315049410127e-06,
        4.353315049410127e-06,
        4.353315049410127e-06,
        4.353315049410127e-06,
        4.353315049410127e-06,
        4.353315049410127e-06,
        4.353315049410127e-06,
        4.353315049410127e-06,
        4.353315049410127e-06,
        4.353315049410127e-06,
        4.353315049410127e-06,
        4.353315049410127e-06,
        4.353315049410127e-06,
        4.353315049410127e-06,
        4.353315049410127e-06,
    ],
)

LIBRARIES = lambda: np.random.choice(
    [
        "50c",
        "70c",
        "60c",
        "66c",
        "80c",
        "00c",
        "55c",
        "62c",
        "37c",
        "49c",
        "42c",
        "90c",
        "61c",
        "35c",
        "51c",
        "56c",
        "32c",
        "48c",
    ],
    p=[
        0.4870022416429176,
        0.12522692243100475,
        0.1020853063629582,
        0.10109651367670915,
        0.07394348855435547,
        0.033613257486123344,
        0.019559394461325378,
        0.019389870076947615,
        0.010084265548928916,
        0.009558114869757547,
        0.006822400984588596,
        0.003361325748612334,
        0.0030642388768915467,
        0.001714354157697403,
        0.0013827843264896304,
        0.0011329593303170344,
        0.0008403314371530835,
        0.0001222300272222667,
    ],
)
