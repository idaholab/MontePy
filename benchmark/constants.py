import montepy

import numpy as np


"""
These data were aggregated from a subset of MCNP models included in the following projects:

Nuclear Energy Agency (2020). Internationl Handbook of Evaluated criticality Safety Benchmark Experiments. 
    Paris, OECD Nuclear Energy Agency.

Nuclear Energy Agency (2023). International Handbook of Evaluated Reactor Physics Benchmark Experiments, 
    Nuclear Energy Agency, Organisation for Economic Co-operation and Development.
D. Laghi et al., "JADE, a new software tool for nuclear fusion data libraries verification & validation," 
    Fusion Engineering and Design, vol. 161, no. 112075, p. 8, December 2020, doi: 10.1016/j.fusengdes.2020.112075.
"""

# TODO UPDATE HOW DENSITY AND VOID IS USED

SURF_ABOVE_CURVE = lambda: np.random.binomial(1, 0.9479)

SURF_TOP_CURVE = lambda x: 1.58 * x**0.92

SURF_BOT_CURVE = lambda x: 5.55 * x**0.50

MATERIAL_CURVE = lambda x: 1.45 * x**0.42

OBJ_NUMBER = lambda: np.random.randint(1, 99_999_999)

ATOM_MASS_DENSITY = lambda: np.random.binomial(1, 0.985525)


def MASS_DENSITY():
    sample = np.random.normal(11.165, 8.54)
    return sample if sample > 0.0 else 0.001


def ATOM_DENSITY():
    sample = np.random.normal(0.0642, 0.117)
    return sample if sample > 0.0 else 0.00001


GEOM_OP = lambda: np.random.choice(
    [
        montepy.Operator.INTERSECTION,
        montepy.Operator.UNION,
        montepy.Operator.COMPLEMENT,
    ],
    p=[0.941102, 0.002747, 8.73e-4],
)


def N_CELLS_NOISE(n):
    new_n = np.round(np.random.normal(n, 0.05 * n))
    new_n = 1 if new_n < 0 else new_n
    return int(new_n)


_st = montepy.SurfaceType
_p = np.array(
    [
        0.2578974704838097,
        0.25340124188934626,
        0.15277874679256107,
        0.13576284719799686,
        0.0666604649720536,
        0.06070683814352272,
        0.025744784762436336,
        0.01987643123483492,
        0.012232842624247075,
        0.00503112475483926,
        0.001689961782056947,
        0.001627944835926417,
        0.0012403389226106033,
        0.0010155274928874314,
        0.0006899385257021481,
        0.0006821864074358318,
        0.0006124173430389854,
        0.0005426482786421389,
        0.0004806313325116088,
        0.0004263665046473949,
        0.00022481142972317187,
        0.00020155507492422304,
        0.0001860508383915905,
        0.00011628177399474406,
        9.302541919579525e-05,
        7.75211826631627e-05,
        0.0,
        0.0,
        0.0,
        0.0,
        0.0,
        0.0,
        0.0,
        0.0,
        0.0,
        0.0,
        0.0,
        0.0,
        0.0,
        0.0,
    ]
)
_p = _p / np.sum(_p)
SURF_TYPE = lambda: np.random.choice(
    [
        _st.C_Z,
        _st.PZ,
        _st.S,
        _st.PX,
        _st.PY,
        _st.CZ,
        _st.RPP,
        _st.P,
        _st.RCC,
        _st.SO,
        _st.C_Y,
        _st.CY,
        _st.TZ,
        _st.KZ,
        _st.CX,
        _st.BOX,
        _st.C_X,
        _st.SY,
        _st.Z,
        _st.SZ,
        _st.SX,
        _st.SPH,
        _st.RHP,
        _st.SQ,
        _st.TRC,
        _st.HEX,
        _st.KX,
        _st.GQ,
        _st.K_Z,
        _st.K_Y,
        _st.K_X,
        _st.KY,
        _st.TX,
        _st.X,
        _st.Y,
        _st.TY,
        _st.REC,
        _st.ELL,
        _st.WED,
        _st.ARB,
    ],
    p=_p,
)

NUM_CONSTANTS = {
    _st.PZ: 1,
    _st.CZ: 1,
    _st.SO: 1,
    _st.PX: 1,
    _st.PY: 1,
    _st.C_Z: 3,
    _st.C_X: 3,
    _st.RCC: 7,
    _st.P: 4,
    _st.RPP: 6,
    _st.CX: 1,
    _st.C_Y: 3,
    _st.SX: 2,
    _st.Z: 9,
    _st.CY: 1,
    _st.KZ: 3,
    _st.BOX: 12,
    _st.RHP: 15,
    _st.SY: 2,
    _st.SQ: 10,
    _st.SZ: 2,
    _st.TRC: 8,
    _st.S: 4,
    _st.SPH: 4,
}
SURFACE_CONSTANT = lambda: np.round(
    np.random.uniform(0.0, 15.0), np.random.randint(1, 8)
)

USES_UNIVERSES = lambda: np.random.binomial(1, 0.4855)

NUM_SURFS_IN_CELL = lambda: np.random.exponential(5.65147)

CELL_GEOM_COMP = lambda: np.random.binomial(1, 1.063e-3)

CELL_GEOM_INTERSECT = lambda: np.random.binomial(1, 0.941102)

CELL_GEOM_SIDE = lambda: np.random.binomial(1, 0.472148)

NUM_NUCLIDES = lambda: np.random.exponential(15.0932)

IS_VOID = lambda: np.random.binomial(1, 0.2767)

ISOTOPE = lambda: np.random.choice(
    [
        "O-16",
        "H-1",
        "Mn-55",
        "C-0",
        "Al-27",
        "Fe-56",
        "Fe-57",
        "Fe-54",
        "Fe-58",
        "U-238",
        "Si-0",
        "U-235",
        "Fe-0",
        "Cr-52",
        "Cr-50",
        "Cr-54",
        "Cr-53",
        "Ni-58",
        "Ni-60",
        "Ni-62",
        "Ni-61",
        "Ni-64",
        "Cr-0",
        "U-234",
        "Si-28",
        "Si-30",
        "Si-29",
        "Cu-63",
        "Cu-65",
        "Cu-0",
        "Ni-0",
        "U-236",
        "Mo-94",
        "Mo-98",
        "Mo-97",
        "Mo-96",
        "Mo-92",
        "Mo-100",
        "Mo-95",
        "N-14",
        "Mg-0",
        "B-10",
        "Ti-0",
        "C-12",
        "S-32",
        "Co-59",
        "Pu-239",
        "B-11",
        "Pu-240",
        "P-31",
        "Pu-241",
        "Na-23",
        "Pu-242",
        "Mo-0",
        "Sm-149",
        "Xe-135",
        "Ca-0",
        "Am-241",
        "Pu-238",
        "Cl-35",
        "Cl-37",
        "F-19",
        "Gd-157",
        "Gd-154",
        "Gd-160",
        "Gd-158",
        "Gd-156",
        "Gd-155",
        "Gd-152",
        "Cd-0",
        "K-0",
        "Zr-0",
        "Ca-46",
        "Ca-44",
        "Ca-43",
        "Ca-42",
        "Ca-40",
        "Ti-48",
        "O-17",
        "Th-232",
        "Li-6",
        "Nb-93",
        "Ti-50",
        "Ti-49",
        "Ti-47",
        "Ti-46",
        "S-0",
        "H-2",
        "S-34",
        "S-33",
        "Mg-24",
        "Hf-0",
        "S-36",
        "Li-7",
        "N-15",
        "Mg-26",
        "Mg-25",
        "Ag-107",
        "Ag-109",
        "V-0",
        "C-13",
        "Ta-181",
        "Cl-0",
        "U-233",
        "Cd-114",
        "Cd-110",
        "Cd-112",
        "Cd-113",
        "Cd-111",
        "Cd-108",
        "Cd-116",
        "Cd-106",
        "Zn-0",
        "W-184",
        "W-186",
        "W-182",
        "W-183",
        "Ga-0",
        "Be-9",
        "Pb-206",
        "Pb-207",
        "Pb-208",
        "Ar-0",
        "Ga-69",
        "Ga-71",
        "O-18",
        "Ca-48",
        "Zn-64",
        "Zn-67",
        "Zn-70",
        "Zn-68",
        "Zn-66",
        "Ba-138",
        "Gd-0",
        "V-51",
        "V-50",
        "Sn-0",
        "K-41",
        "K-40",
        "K-39",
        "Bi-209",
        "Pb-0",
        "Au-197",
        "Pb-204",
        "Sb-123",
        "Sb-121",
        "Zr-96",
        "Zr-94",
        "Zr-90",
        "Zr-91",
        "Zr-92",
        "As-75",
        "Np-237",
        "Cf-252",
        "Pt-0",
        "Ba-137",
        "Ba-134",
        "Ba-132",
        "Ba-135",
        "Ba-130",
        "Ba-136",
        "W-0",
        "U-232",
        "In-113",
        "In-115",
        "Sr-84",
        "Sr-88",
        "Sr-86",
        "Sr-87",
        "Sn-124",
        "Sn-120",
        "Sn-117",
        "Sn-115",
        "Sn-116",
        "Sn-114",
        "Sn-122",
        "Sn-118",
        "Sn-119",
        "Sn-112",
        "Ar-40",
        "Re-187",
        "Re-185",
        "Hf-180",
        "Hf-176",
        "Hf-178",
        "Hf-174",
        "Hf-179",
        "Hf-177",
        "Rb-85",
        "Rb-87",
        "Ar-38",
        "Ar-36",
        "Rh-103",
        "W-180",
        "Dy-162",
        "Dy-164",
        "Dy-160",
        "Dy-158",
        "Dy-156",
        "Dy-161",
        "Dy-163",
        "Sb-0",
        "Eu-153",
        "Eu-151",
        "Th-230",
        "Se-82",
        "Te-120",
        "Te-122",
        "Te-123",
        "Te-126",
        "Te-130",
        "Te-124",
        "Te-125",
        "Se-74",
        "Se-76",
        "Se-77",
        "Se-80",
        "Te-128",
        "Se-78",
        "Er-162",
        "Er-168",
        "Er-164",
        "Er-170",
        "Er-167",
        "Er-166",
        "He-4",
        "Kr-83",
        "Kr-78",
        "Kr-80",
        "Kr-82",
        "Kr-86",
        "Kr-84",
        "He-3",
        "Sm-152",
        "Sm-150",
        "Sm-154",
        "Sm-147",
        "Sm-148",
        "Sm-144",
        "Ne-20",
        "Xe-124",
        "Xe-132",
        "Xe-130",
        "Xe-129",
        "Ne-21",
        "Ne-22",
        "Xe-134",
        "Xe-136",
        "Xe-131",
        "Xe-128",
        "Xe-126",
        "Lu-175",
        "Lu-176",
        "Y-89",
        "Am-243",
        "In-0",
        "Br-81",
        "Br-79",
    ],
    p=[
        0.044979323874188605,
        0.04024617072045347,
        0.03537533720454376,
        0.03406862854592008,
        0.029567622577781835,
        0.024079147413873642,
        0.023952821417690735,
        0.02394628151076996,
        0.023895088841015457,
        0.022718644361965586,
        0.022378525466975743,
        0.022324974408818428,
        0.02171947785764391,
        0.019696295213665227,
        0.019580211865821474,
        0.019580211865821474,
        0.019580211865821474,
        0.01949254048796278,
        0.019484818757507544,
        0.01934369182092123,
        0.01934369182092123,
        0.019309549659790717,
        0.018674305759833382,
        0.017946003751777326,
        0.01787926504311953,
        0.01775293904693662,
        0.01775293904693662,
        0.0171192458759141,
        0.017002449109778064,
        0.01639638594640393,
        0.013131380515462601,
        0.011843840649710186,
        0.011734995694323496,
        0.011734995694323496,
        0.011734995694323496,
        0.011734995694323496,
        0.011734995694323496,
        0.011734995694323496,
        0.011734995694323496,
        0.0106929996757818,
        0.010319613117201478,
        0.00934451227308913,
        0.0081281445573801,
        0.007242922802024666,
        0.007221454641721495,
        0.00692767797013135,
        0.006532625312042364,
        0.006149013394669701,
        0.006027921560479737,
        0.005791215536915438,
        0.005197925623396912,
        0.004473970878750518,
        0.004183183165011806,
        0.0038073467149676806,
        0.0036423153880141422,
        0.003625575974253691,
        0.00358309126425913,
        0.0032935817254011834,
        0.002996209557196541,
        0.002227460611841314,
        0.002227460611841314,
        0.0020741961566293804,
        0.002017858118313526,
        0.002017858118313526,
        0.002017858118313526,
        0.002017858118313526,
        0.002017858118313526,
        0.002017858118313526,
        0.0020114876906879545,
        0.0018828059502672568,
        0.0018455285338841749,
        0.0017347184144037488,
        0.0014927801770316083,
        0.0014927801770316083,
        0.0014927801770316083,
        0.0014927801770316083,
        0.0014927801770316083,
        0.0013588930953231555,
        0.00133428414903969,
        0.001287368165772112,
        0.001273658427796941,
        0.0012642942483536506,
        0.0012325670991402491,
        0.0012325670991402491,
        0.0012325670991402491,
        0.0012325670991402491,
        0.0012269254377789366,
        0.0011710253314494376,
        0.0011375965994320804,
        0.0011061996255947893,
        0.0010937421809511859,
        0.001084060659492539,
        0.0010620617965063544,
        0.001056161772668991,
        0.000986345672560151,
        0.0009674161847682793,
        0.0009674161847682793,
        0.0007872421613883364,
        0.0007819656455772567,
        0.0007477703632262214,
        0.0007310864970968468,
        0.0007242235710649479,
        0.0007131025124011755,
        0.0006581970949044799,
        0.000650633205200174,
        0.000650633205200174,
        0.000650633205200174,
        0.000650633205200174,
        0.000650633205200174,
        0.000650633205200174,
        0.000650633205200174,
        0.000650633205200174,
        0.0005914418399592255,
        0.0005556357175998304,
        0.0005556357175998304,
        0.0005556357175998304,
        0.0005556357175998304,
        0.000514333072033181,
        0.0005071678659841494,
        0.00047583958667942627,
        0.00047583958667942627,
        0.00047583958667942627,
        0.0004652867328790381,
        0.00044425978558142176,
        0.00044425978558142176,
        0.0004419352159054776,
        0.00044023925950194384,
        0.0003773388015261148,
        0.0003773388015261148,
        0.0003773388015261148,
        0.0003773388015261148,
        0.0003773388015261148,
        0.00033225586564732167,
        0.0003164498220697349,
        0.00031398720470305345,
        0.00031398720470305345,
        0.000313476709783342,
        0.0003099892226499286,
        0.0003099892226499286,
        0.0003099892226499286,
        0.0002920209047772678,
        0.0002883842076769648,
        0.00025293793467228315,
        0.0002504229262459674,
        0.0002087480101885358,
        0.0002087480101885358,
        0.00020306241494099706,
        0.00020306241494099706,
        0.00020306241494099706,
        0.00020306241494099706,
        0.00020306241494099706,
        0.00019666851975725858,
        0.0001869662679241604,
        0.0001792842816697945,
        0.0001792842816697945,
        0.00017766638876378545,
        0.00017766638876378545,
        0.00017766638876378545,
        0.00017766638876378545,
        0.00017766638876378545,
        0.00017766638876378545,
        0.00014776239592127988,
        0.00014063944065685315,
        0.00014012354526688264,
        0.00014012354526688264,
        0.00012675942892420583,
        0.00012675942892420583,
        0.00012675942892420583,
        0.00012675942892420583,
        0.00011899527424347498,
        0.00011899527424347498,
        0.00011899527424347498,
        0.00011899527424347498,
        0.00011899527424347498,
        0.00011899527424347498,
        0.00011899527424347498,
        0.00011899527424347498,
        0.00011899527424347498,
        0.00011899527424347498,
        8.688572082268976e-05,
        7.891897655792084e-05,
        7.891897655792084e-05,
        7.25673796527412e-05,
        7.25673796527412e-05,
        7.25673796527412e-05,
        7.25673796527412e-05,
        7.25673796527412e-05,
        7.25673796527412e-05,
        6.58701625852562e-05,
        6.58701625852562e-05,
        6.09677406437389e-05,
        6.09677406437389e-05,
        5.616936185987991e-05,
        5.3794722171494745e-05,
        5.359454090266607e-05,
        5.359454090266607e-05,
        5.359454090266607e-05,
        5.359454090266607e-05,
        5.359454090266607e-05,
        5.359454090266607e-05,
        5.359454090266607e-05,
        5.167699918031942e-05,
        4.901230348778113e-05,
        4.901230348778113e-05,
        4.353125544140693e-05,
        3.801064624645737e-05,
        3.801064624645737e-05,
        3.801064624645737e-05,
        3.801064624645737e-05,
        3.801064624645737e-05,
        3.801064624645737e-05,
        3.801064624645737e-05,
        3.801064624645737e-05,
        3.801064624645737e-05,
        3.801064624645737e-05,
        3.801064624645737e-05,
        3.801064624645737e-05,
        3.801064624645737e-05,
        3.801064624645737e-05,
        2.9204126457533352e-05,
        2.9204126457533352e-05,
        2.9204126457533352e-05,
        2.9204126457533352e-05,
        2.9204126457533352e-05,
        2.9204126457533352e-05,
        2.7117095178920116e-05,
        1.7896003114227517e-05,
        1.7896003114227517e-05,
        1.7896003114227517e-05,
        1.7896003114227517e-05,
        1.7896003114227517e-05,
        1.7896003114227517e-05,
        1.7896003114227517e-05,
        1.6739413760450625e-05,
        1.6739413760450625e-05,
        1.6739413760450625e-05,
        1.6739413760450625e-05,
        1.6739413760450625e-05,
        1.6739413760450625e-05,
        1.3779677981452554e-05,
        1.3779677981452554e-05,
        1.3779677981452554e-05,
        1.3779677981452554e-05,
        1.3779677981452554e-05,
        1.3779677981452554e-05,
        1.3779677981452554e-05,
        1.3779677981452554e-05,
        1.3779677981452554e-05,
        1.3779677981452554e-05,
        1.3779677981452554e-05,
        1.3779677981452554e-05,
        8.189301435185312e-06,
        8.189301435185312e-06,
        8.189301435185312e-06,
        7.681986254365929e-06,
        5.276515811079628e-06,
        4.58223741488494e-06,
        4.58223741488494e-06,
    ],
)

LIBRARIES = lambda: np.random.choice(
    [
        "50c",
        "66c",
        "60c",
        "70c",
        "80c",
        "00c",
        "37c",
        "55c",
        "62c",
        "49c",
        "42c",
        "90c",
        "61c",
        "35c",
        "56c",
        "51c",
        "32c",
        "02c",
        "03c",
        "48c",
        "69c",
    ],
    p=[
        0.5117680257258742,
        0.13817024205122397,
        0.09717837407155762,
        0.09585327232633302,
        0.05476167138777253,
        0.029457403206773335,
        0.019915077653643882,
        0.016020009351620623,
        0.014360107988212474,
        0.007263365607644883,
        0.005148683012593848,
        0.0024893580174738033,
        0.0022693390007778864,
        0.001798614585886914,
        0.0011617632578283276,
        0.0010240736861058903,
        0.0006223395043684508,
        0.0003819986727581284,
        0.00023936134783401954,
        9.052210972632011e-05,
        2.6397433989921435e-05,
    ],
)
