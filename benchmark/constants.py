import montepy

import numpy as np


"""
These data were aggregated from a subset of MCNP models included in the following projects:

Nuclear Energy Agency (2020). Internationl Handbook of Evaluated criticality Safety Benchmark Experiments. 
    Paris, OECD Nuclear Energy Agency.

Nuclear Energy Agency (2023). International Handbook of Evaluated Reactor Physics Benchmark Experiments, 
    Nuclear Energy Agency, Organisation for Economic Co-operation and Development.
D. Laghi et al., "JADE, a new software tool for nuclear fusion data libraries verification & validation," 
    Fusion Engineering and Design, vol. 161, no. 112075, p. 8, December 2020, doi: 10.1016/j.fusengdes.2020.112075.
"""

# TODO UPDATE HOW DENSITY AND VOID IS USED

SURF_ABOVE_CURVE = lambda: np.random.binomial(1, 0.9479)

SURF_TOP_CURVE = lambda x: 1.59 * x**0.92

SURF_BOT_CURVE = lambda x: 5.55 * x**0.50

MATERIAL_CURVE = lambda x: 1.43 * x**0.43

OBJ_NUMBER = lambda: np.random.randint(1, 99_999_999)

ATOM_MASS_DENSITY = lambda: np.random.binomial(1, 0.98586)

IS_VOID = lambda: np.random.binomial(1, 0.27046)


def MASS_DENSITY():
    sample = np.random.normal(11.165, 8.54)
    return sample if sample > 0.0 else 0.001


def ATOM_DENSITY():
    sample = np.random.normal(0.0639, 0.116)
    return sample if sample > 0.0 else 0.00001


GEOM_OP = lambda: np.random.choice(
    [
        montepy.Operator.INTERSECTION,
        montepy.Operator.UNION,
        montepy.Operator.COMPLEMENT,
    ],
    p=[0.9355, 0.00537, 8.68e-4],
)


def N_CELLS_NOISE(n):
    new_n = np.round(np.random.normal(n, 0.05 * n))
    new_n = 1 if new_n < 0 else new_n
    return int(new_n)


_st = montepy.SurfaceType
_p = np.array(
    [
        0.24544381894688957,
        0.23675082451950416,
        0.1400830205845559,
        0.12549044694643466,
        0.062116171954964175,
        0.05566217445695439,
        0.04141078130330945,
        0.02884396679176618,
        0.023605424769703173,
        0.018224724212441715,
        0.013455305356533605,
        0.0015495280336631412,
        0.0014926646195837598,
        0.0011372682815876266,
        0.0009311384055498692,
        0.0006326054816331172,
        0.0006254975548731946,
        0.0005615262140338906,
        0.0004975548731945866,
        0.00044069145911520527,
        0.0003909359717957466,
        0.0002061298760377573,
        0.0001848060957579893,
        0.00010661890139883998,
        8.5295121119072e-05,
        7.107926759922666e-05,
        0.0,
        0.0,
        0.0,
        0.0,
        0.0,
        0.0,
        0.0,
        0.0,
        0.0,
        0.0,
        0.0,
        0.0,
        0.0,
        0.0,
    ]
)
_p = _p / np.sum(_p)
SURF_TYPE = lambda: np.random.choice(
    [
        _st.PZ,
        _st.C_Z,
        _st.S,
        _st.PX,
        _st.PY,
        _st.CZ,
        _st.RCC,
        _st.RHP,
        _st.RPP,
        _st.P,
        _st.SO,
        _st.C_Y,
        _st.CY,
        _st.TZ,
        _st.KZ,
        _st.CX,
        _st.BOX,
        _st.C_X,
        _st.SY,
        _st.Z,
        _st.SZ,
        _st.SX,
        _st.SPH,
        _st.SQ,
        _st.TRC,
        _st.HEX,
        _st.KX,
        _st.GQ,
        _st.K_Z,
        _st.K_Y,
        _st.K_X,
        _st.KY,
        _st.TX,
        _st.X,
        _st.Y,
        _st.TY,
        _st.REC,
        _st.ELL,
        _st.WED,
        _st.ARB,
    ],
    p=_p,
)

NUM_CONSTANTS = {
    _st.PZ: 1,
    _st.CZ: 1,
    _st.SO: 1,
    _st.PX: 1,
    _st.PY: 1,
    _st.C_Z: 3,
    _st.C_X: 3,
    _st.RCC: 7,
    _st.P: 4,
    _st.RPP: 6,
    _st.CX: 1,
    _st.C_Y: 3,
    _st.SX: 2,
    _st.Z: 9,
    _st.CY: 1,
    _st.KZ: 3,
    _st.BOX: 12,
    _st.RHP: 15,
    _st.SY: 2,
    _st.SQ: 10,
    _st.SZ: 2,
    _st.TRC: 8,
    _st.S: 4,
    _st.SPH: 4,
}
SURFACE_CONSTANT = lambda: np.round(
    np.random.uniform(0.0, 15.0), np.random.randint(1, 8)
)

USES_UNIVERSES = lambda: np.random.binomial(1, 0.4855)

NUM_SURFS_IN_CELL = lambda: np.random.exponential(5.65147)

CELL_GEOM_COMP = lambda: np.random.binomial(1, 1.063e-3)

CELL_GEOM_INTERSECT = lambda: np.random.binomial(1, 0.941102)

CELL_GEOM_SIDE = lambda: np.random.binomial(1, 0.472148)

NUM_NUCLIDES = lambda: np.random.exponential(15.0932)

IS_VOID = lambda: np.random.binomial(1, 0.2767)

ISOTOPE = lambda: np.random.choice(
    [
        "O-16",
        "H-1",
        "Mn-55",
        "C-0",
        "Al-27",
        "U-238",
        "U-235",
        "Fe-56",
        "Fe-57",
        "Fe-54",
        "Fe-58",
        "Si-0",
        "Fe-0",
        "U-234",
        "Cr-52",
        "Cr-54",
        "Cr-50",
        "Cr-53",
        "Ni-58",
        "Ni-60",
        "Ni-61",
        "Ni-62",
        "Ni-64",
        "Cr-0",
        "Si-28",
        "Si-29",
        "Si-30",
        "Cu-0",
        "Cu-63",
        "Cu-65",
        "U-236",
        "Mo-97",
        "Mo-98",
        "Mo-100",
        "Mo-95",
        "Ni-0",
        "Mo-94",
        "Mo-96",
        "Mo-92",
        "N-14",
        "Mg-0",
        "B-10",
        "Pu-239",
        "Pu-240",
        "Ti-0",
        "Pu-241",
        "S-32",
        "C-12",
        "Co-59",
        "B-11",
        "P-31",
        "Pu-242",
        "Am-241",
        "Pu-238",
        "Na-23",
        "Mo-0",
        "Sm-149",
        "Xe-135",
        "Ca-0",
        "Zr-96",
        "Zr-94",
        "Zr-92",
        "Np-237",
        "Rh-103",
        "Xe-134",
        "Am-243",
        "Pu-236",
        "Cm-245",
        "Cm-246",
        "Cs-135",
        "Ce-142",
        "Nd-148",
        "Cs-137",
        "La-139",
        "Cm-244",
        "Cs-133",
        "Cm-243",
        "Cm-242",
        "Sr-90",
        "Ru-102",
        "Zr-93",
        "Ru-101",
        "Tc-99",
        "Ru-104",
        "Cl-37",
        "Cl-35",
        "Gd-160",
        "Gd-155",
        "Gd-156",
        "Gd-154",
        "Gd-157",
        "Gd-158",
        "Gd-152",
        "F-19",
        "Zr-91",
        "Sr-88",
        "Cd-0",
        "K-0",
        "Te-130",
        "Xe-131",
        "Xe-132",
        "Y-89",
        "Nd-143",
        "Nd-144",
        "Nd-146",
        "Pd-105",
        "Pd-106",
        "Pr-141",
        "Nd-145",
        "Zr-0",
        "Ca-46",
        "Ca-42",
        "Ca-43",
        "Ca-44",
        "Ca-40",
        "S-34",
        "Ti-48",
        "S-33",
        "O-17",
        "S-36",
        "Th-232",
        "Li-6",
        "Nb-93",
        "Ti-49",
        "Ti-46",
        "Ti-47",
        "Ti-50",
        "S-0",
        "H-2",
        "Mg-24",
        "Hf-0",
        "Li-7",
        "N-15",
        "Mg-26",
        "Mg-25",
        "Ag-107",
        "Ag-109",
        "V-0",
        "C-13",
        "Ta-181",
        "Cl-0",
        "U-233",
        "Ru-96",
        "Ru-100",
        "Ru-99",
        "Cd-111",
        "Cd-116",
        "Cd-112",
        "Cd-113",
        "Cd-114",
        "Cd-108",
        "Cd-106",
        "Cd-110",
        "Zn-0",
        "W-186",
        "W-183",
        "W-184",
        "W-182",
        "Ga-0",
        "Be-9",
        "Pb-207",
        "Pb-206",
        "Pb-208",
        "Ar-0",
        "Ga-71",
        "Ga-69",
        "O-18",
        "Ca-48",
        "Zn-64",
        "Zn-66",
        "Zn-67",
        "Zn-70",
        "Zn-68",
        "Ba-138",
        "Gd-0",
        "V-51",
        "V-50",
        "Sn-0",
        "K-41",
        "K-40",
        "K-39",
        "Bi-209",
        "Pb-0",
        "Au-197",
        "Pb-204",
        "Sb-123",
        "Sb-121",
        "Zr-90",
        "As-75",
        "Cf-252",
        "Pt-0",
        "Ba-130",
        "Ba-135",
        "Ba-132",
        "Ba-134",
        "Ba-136",
        "Ba-137",
        "W-0",
        "U-232",
        "In-115",
        "In-113",
        "Sr-84",
        "Sr-86",
        "Sr-87",
        "Sn-114",
        "Sn-120",
        "Sn-124",
        "Sn-122",
        "Sn-118",
        "Sn-119",
        "Sn-116",
        "Sn-117",
        "Sn-115",
        "Sn-112",
        "Ar-40",
        "Re-187",
        "Re-185",
        "Hf-174",
        "Hf-178",
        "Hf-179",
        "Hf-177",
        "Hf-176",
        "Hf-180",
        "Rb-85",
        "Rb-87",
        "Ar-36",
        "Ar-38",
        "W-180",
        "Dy-163",
        "Dy-164",
        "Dy-158",
        "Dy-160",
        "Dy-161",
        "Dy-156",
        "Dy-162",
        "Sb-0",
        "Eu-151",
        "Eu-153",
        "Th-230",
        "Te-124",
        "Te-126",
        "Te-125",
        "Te-122",
        "Te-120",
        "Se-77",
        "Te-128",
        "Se-82",
        "Se-78",
        "Se-80",
        "Se-76",
        "Se-74",
        "Te-123",
        "He-4",
        "Er-168",
        "Er-166",
        "Er-167",
        "Er-170",
        "Er-164",
        "Er-162",
        "He-3",
        "Kr-83",
        "Kr-82",
        "Kr-86",
        "Kr-84",
        "Kr-78",
        "Kr-80",
        "Sm-154",
        "Sm-152",
        "Sm-147",
        "Sm-144",
        "Sm-148",
        "Sm-150",
        "Ne-20",
        "Ne-21",
        "Xe-124",
        "Ne-22",
        "Xe-126",
        "Xe-128",
        "Xe-136",
        "Xe-130",
        "Xe-129",
        "Lu-175",
        "Lu-176",
        "In-0",
        "Br-79",
        "Br-81",
    ],
    p=[
        0.04001233789204275,
        0.03569378319444407,
        0.03187859236354461,
        0.030423384785915438,
        0.026464865132792493,
        0.02228186539585894,
        0.021935814504797358,
        0.021475012950945758,
        0.021363967586183072,
        0.021358218758772442,
        0.021313218451172778,
        0.020145374805338664,
        0.019566046841296585,
        0.018084557394106717,
        0.017622318842217665,
        0.017520277155678977,
        0.017520277155678977,
        0.017520277155678977,
        0.01744321067350004,
        0.017436422978164872,
        0.017312367022743178,
        0.017312367022743178,
        0.017282354761996504,
        0.01673129181859823,
        0.01602508007767303,
        0.01591403471291034,
        0.01591403471291034,
        0.015360644298903447,
        0.015048469516919984,
        0.014945800708514947,
        0.012720523481962905,
        0.012570214723203242,
        0.012570214723203242,
        0.012570214723203242,
        0.012570214723203242,
        0.011542983892768262,
        0.010993543887964382,
        0.010993543887964382,
        0.010993543887964382,
        0.009399554211195387,
        0.009387198599353629,
        0.008223486927818503,
        0.007893830095496282,
        0.007450176264275176,
        0.007302881520069092,
        0.0067205782055235735,
        0.006553155773503393,
        0.006366805161261401,
        0.00608969294046039,
        0.00541452163741963,
        0.00529592109584376,
        0.005253848252904269,
        0.005046587347138808,
        0.004785185878823895,
        0.00414277173115404,
        0.003346802855442794,
        0.003201734029923365,
        0.003187019447310841,
        0.003149673768189084,
        0.0023299030976096586,
        0.0023299030976096586,
        0.0023299030976096586,
        0.0023157539709788223,
        0.0022007785060499,
        0.0021635163585055454,
        0.0021581562551024076,
        0.0021514034964344067,
        0.0021514034964344067,
        0.0021514034964344067,
        0.0021514034964344067,
        0.0021514034964344067,
        0.0021514034964344067,
        0.0021514034964344067,
        0.0021514034964344067,
        0.0021514034964344067,
        0.0021514034964344067,
        0.0021514034964344067,
        0.0021514034964344067,
        0.0021514034964344067,
        0.0021514034964344067,
        0.0021514034964344067,
        0.0021514034964344067,
        0.0021514034964344067,
        0.0021514034964344067,
        0.0019580227634089123,
        0.0019580227634089123,
        0.001903877334258884,
        0.001903877334258884,
        0.001903877334258884,
        0.001903877334258884,
        0.001903877334258884,
        0.001903877334258884,
        0.0018982774856073706,
        0.0018232974665703925,
        0.001755170436414111,
        0.0016880972038987013,
        0.001655058181548519,
        0.0016222899119543784,
        0.0016100836418253346,
        0.0015887836973099978,
        0.0015887836973099978,
        0.0015838695432839158,
        0.0015766708352388586,
        0.0015766708352388586,
        0.0015766708352388586,
        0.0015766708352388586,
        0.0015766708352388586,
        0.0015766708352388586,
        0.0015766708352388586,
        0.0015248835941028673,
        0.001312210663504071,
        0.001312210663504071,
        0.001312210663504071,
        0.001312210663504071,
        0.001312210663504071,
        0.00120521270648601,
        0.0011945188164213826,
        0.0011776135699855662,
        0.0011728866148235728,
        0.0011388147361820961,
        0.0011316456776248262,
        0.0011195942954845305,
        0.0011113628248972899,
        0.001083473451658695,
        0.001083473451658695,
        0.001083473451658695,
        0.001083473451658695,
        0.0010785142163257913,
        0.0010293758925824779,
        0.0009614410581350824,
        0.000952930631822856,
        0.0009284064471149976,
        0.0008670354345193849,
        0.000850395693372395,
        0.000850395693372395,
        0.0006920158606258705,
        0.0006873776021468394,
        0.0006573186458229499,
        0.0006426528916949889,
        0.0006366201181758461,
        0.0006268442838014408,
        0.0005785803294484473,
        0.0005747326611955479,
        0.0005747326611955479,
        0.0005747326611955479,
        0.0005719313821484534,
        0.0005719313821484534,
        0.0005719313821484534,
        0.0005719313821484534,
        0.0005719313821484534,
        0.0005719313821484534,
        0.0005719313821484534,
        0.0005719313821484534,
        0.0005198999163964185,
        0.0004884249703181822,
        0.0004884249703181822,
        0.0004884249703181822,
        0.0004884249703181822,
        0.0004521183708754842,
        0.0004458198817017871,
        0.00041828113031332925,
        0.00041828113031332925,
        0.00041828113031332925,
        0.00040900476966738026,
        0.00039052128168341163,
        0.00039052128168341163,
        0.0003884778963519573,
        0.00038698708604257854,
        0.0003316951864279276,
        0.0003316951864279276,
        0.0003316951864279276,
        0.0003316951864279276,
        0.0003316951864279276,
        0.000292065567738953,
        0.0002781714530866787,
        0.0002760067185742501,
        0.0002760067185742501,
        0.00027555797408553235,
        0.0002724923399917046,
        0.0002724923399917046,
        0.0002724923399917046,
        0.0002566975038326249,
        0.00025350070849170517,
        0.00022234208370964866,
        0.00022013129545924692,
        0.00018349745606841155,
        0.00018349745606841155,
        0.00017849960117525241,
        0.00017287912364579274,
        0.00015759771587641494,
        0.00015759771587641494,
        0.0001561755263562578,
        0.0001561755263562578,
        0.0001561755263562578,
        0.0001561755263562578,
        0.0001561755263562578,
        0.0001561755263562578,
        0.00012988877704577686,
        0.00012362742792186948,
        0.00012317393621398917,
        0.00012317393621398917,
        0.00011142636865984272,
        0.00011142636865984272,
        0.00011142636865984272,
        0.00010460138081373577,
        0.00010460138081373577,
        0.00010460138081373577,
        0.00010460138081373577,
        0.00010460138081373577,
        0.00010460138081373577,
        0.00010460138081373577,
        0.00010460138081373577,
        0.00010460138081373577,
        0.00010460138081373577,
        8.032591235819316e-05,
        6.937278789302865e-05,
        6.937278789302865e-05,
        6.37894921623541e-05,
        6.37894921623541e-05,
        6.37894921623541e-05,
        6.37894921623541e-05,
        6.37894921623541e-05,
        6.37894921623541e-05,
        5.790238313788239e-05,
        5.790238313788239e-05,
        5.75430200806878e-05,
        5.75430200806878e-05,
        4.7287610835000795e-05,
        4.711164387105497e-05,
        4.711164387105497e-05,
        4.711164387105497e-05,
        4.711164387105497e-05,
        4.711164387105497e-05,
        4.711164387105497e-05,
        4.711164387105497e-05,
        4.5426051622113975e-05,
        4.308368256031736e-05,
        4.308368256031736e-05,
        3.8265632452007215e-05,
        3.341280658647589e-05,
        3.341280658647589e-05,
        3.341280658647589e-05,
        3.341280658647589e-05,
        3.341280658647589e-05,
        3.341280658647589e-05,
        3.341280658647589e-05,
        3.341280658647589e-05,
        3.341280658647589e-05,
        3.341280658647589e-05,
        3.341280658647589e-05,
        3.341280658647589e-05,
        3.341280658647589e-05,
        2.778701271344206e-05,
        2.5671540087100983e-05,
        2.5671540087100983e-05,
        2.5671540087100983e-05,
        2.5671540087100983e-05,
        2.5671540087100983e-05,
        2.5671540087100983e-05,
        1.9681321384861273e-05,
        1.573126873059634e-05,
        1.573126873059634e-05,
        1.573126873059634e-05,
        1.573126873059634e-05,
        1.573126873059634e-05,
        1.573126873059634e-05,
        1.4714582612524194e-05,
        1.4714582612524194e-05,
        1.4714582612524194e-05,
        1.4714582612524194e-05,
        1.4714582612524194e-05,
        1.4714582612524194e-05,
        1.2112862071138977e-05,
        1.2112862071138977e-05,
        1.2112862071138977e-05,
        1.2112862071138977e-05,
        1.2112862071138977e-05,
        1.2112862071138977e-05,
        1.2112862071138977e-05,
        1.2112862071138977e-05,
        1.2112862071138977e-05,
        7.198708045057207e-06,
        7.198708045057207e-06,
        4.6382584790311776e-06,
        4.027961310737602e-06,
        4.027961310737602e-06,
    ],
)

LIBRARIES = lambda: np.random.choice(
    [
        "70c",
        "50c",
        "80c",
        "00c",
        "66c",
        "60c",
        "37c",
        "55c",
        "62c",
        "49c",
        "42c",
        "90c",
        "56c",
        "35c",
        "32c",
        "61c",
        "51c",
        "69c",
        "02c",
        "03c",
        "48c",
    ],
    p=[
        0.2802719710867067,
        0.2767340768181774,
        0.15461149353951137,
        0.1397428796492438,
        0.05832842161386439,
        0.05452365874932157,
        0.009982253259708489,
        0.008327341624737038,
        0.0069406234995301,
        0.003023655270255802,
        0.0019702887928120093,
        0.0016347280260854934,
        0.0012475150164716696,
        0.0010161731401725996,
        0.000474598459186111,
        0.00033770530092479733,
        0.00029294370872128385,
        0.0002863044689520327,
        0.00016184090679833283,
        6.0845956305911674e-05,
        3.068111251304152e-05,
    ],
)
